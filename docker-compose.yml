services:
  collector:
    image: public.ecr.aws/z7t5p0k6/claude-log-collector:latest
    # To build locally instead, comment out 'image' and uncomment 'build':
    # build:
    #   context: ./collector
    #   dockerfile: Dockerfile
    container_name: claude-log-collector
    restart: unless-stopped
    environment:
      - DB_HOST=${DB_HOST:-localhost}
      - DB_PORT=${DB_PORT:-5432}
      - DB_NAME=${DB_NAME:-claude_logs}
      - DB_USER=${DB_USER:-claude_admin}
      - DB_PASSWORD=${DB_PASSWORD}
      - COLLECTOR_HOST=${COLLECTOR_HOST:-}
    volumes:
      # Mount Claude projects directory (read-only)
      - ${HOME}/.claude/projects:/claude-projects:ro
      # Persist collector state
      - collector-state:/home/collector/.claude-collector

volumes:
  collector-state:
